<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>OAuth Demo</title>
</head>
<body>
<h2>Welcome to OAuth Demo</h2>

<hr>

Current User: <label id="currentUser" />

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


<script type="text/javascript">
     function performLogin() {
    	var xhr = new XMLHttpRequest();
    	var token = getAccessToken();
    	if (token == null) return;
    	var url = "http://localhost:8080/v2/getProfile";
    	xhr.open("GET", url, true);
    	xhr.setRequestHeader('accessToken', token);
    	//xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
    	xhr.onreadystatechange = function() {//Call a function when the state changes.
    		if(xhr.readyState == 4 && xhr.status == 200) {
    			//alert(xhr.responseText);
				var myProfile = eval('(' + xhr.responseText + ')');
				var lbl = document.getElementById("currentUser");
				lbl.innerHTML = myProfile.firstName + " " + myProfile.lastName;
    		}
    	}
    	xhr.send(null);
    }
	
	performLogin();
     
     function getAccessToken() {
     	var accessTokenKey = "#accessToken=";
    	var loc = window.location.href.toString();
    	var tokenIndex1 = loc.indexOf(accessTokenKey);
    	if (tokenIndex1 < 0) {
    		return null;
    	} else {
        	var token = loc.substring(tokenIndex1 + accessTokenKey.length);
        	return token;
    	}
     }
</script>

</body>
</html>